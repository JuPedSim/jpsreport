<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Jun Zhang">
        <link rel="canonical" href="http://jupedsim.github.io/jpsreport/contributing/utest/">
        <link rel="shortcut icon" href="../../favicon.icon">
        

	<title>Unit testing - JuPedSim/jpsreport</title>

        <link href="../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">JuPedSim/jpsreport</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Running <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../running/Introduction/">Introduction</a>
                        </li>
                    
                        <li >
                            <a href="../../running/get_start/">Getting started</a>
                        </li>
                    
                        <li >
                            <a href="../../running/runJPSreport/">Running JPSreport</a>
                        </li>
                    
                        <li >
                            <a href="../../running/user_support/">User Support</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Input Files <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../inputs/geometry/">Geometry File</a>
                        </li>
                    
                        <li >
                            <a href="../../inputs/trajectory/">Trajectory File</a>
                        </li>
                    
                        <li >
                            <a href="../../inputs/inifile/">Configuration File</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Methods and Output <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../methods/method_A/">Method A</a>
                        </li>
                    
                        <li >
                            <a href="../../methods/method_B/">Method B</a>
                        </li>
                    
                        <li >
                            <a href="../../methods/method_C/">Method C</a>
                        </li>
                    
                        <li >
                            <a href="../../methods/method_D/">Method D</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Sample cases <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../samples/get_fundamental_diagram/">How to get fundamental diagram</a>
                        </li>
                    
                        <li >
                            <a href="../../samples/get_profile/">How to get profiles</a>
                        </li>
                    
                        <li >
                            <a href="../../samples/get_flow_bottleneck/">How to get flow through bottleneck</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contributing <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../code-Style-Conventions/">Code Style</a>
                        </li>
                    
                        <li >
                            <a href="../workflow/">Workflow</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Unit testing</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../workflow/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li class="disabled">
                    <a rel="prev" >
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/JuPedSim/jpsreport">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#unit-testing-verification-and-validation-tests">Unit testing, verification and validation tests</a></li>
        
            <li><a href="#writing-a-unit-test">Writing a unit test</a></li>
        
            <li><a href="#verification-and-validation">Verification and validation</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="unit-testing-verification-and-validation-tests"><a class="toclink" href="#unit-testing-verification-and-validation-tests">Unit testing, verification and validation tests</a></h1>
<p>Testing should be enabled by cmake as follows:</p>
<pre><code class="javascript">cmake -DBUILD_TESTING=ON ..
</code></pre>

<p>After compiling (<code>make</code>) the tests can be called as follows:</p>
<pre><code class="javascript">ctest
</code></pre>

<p>This will take some hours time (depending on your machine). Threfore, a quick testing could be used:</p>
<pre><code class="javascript">ctest -R Boost
</code></pre>

<p>which run a limited set of tests on the code.</p>
<h2 id="writing-a-unit-test"><a class="toclink" href="#writing-a-unit-test">Writing a unit test</a></h2>
<p>If you write a unit test the first lines in your file should be</p>
<pre><code class="c++">#define BOOST_TEST_MODULE MyTest
#define BOOST_TEST_DYN_LINK
#include &lt;boost/test/unit_test.hpp&gt;
#include classtotest.h

BOOST_AUTO_TEST_SUITE(MyTestClass)
</code></pre>

<p>Then you can start implementing your test cases by using</p>
<pre><code class="c++">BOOST_AUTO_TEST_CASE(MyTestCase) 
{
  ...
  }
</code></pre>

<p>For each method or function you want to test you should write a new test case and give it a speaking name.</p>
<h2 id="verification-and-validation"><a class="toclink" href="#verification-and-validation">Verification and validation</a></h2>
<p>Besides unit testing, we use in JuPedSim python-driven tests for verification and validation purposes.
Several validation and verification tests for <em>JuPedSim</em> (jpscore) are defined in the following section (e.g. Rimea and NIST).
In order to make the nightly builds run automatically, consider the following steps, before adding new tests.
This procedure is also recommended to make simulations with several inifiles e.g. different seeds.</p>
<p>To write additional tests, create a directory under <em>Utest/</em>.</p>
<ul>
<li>Create in <em>./jpscore/Utest/</em> a new direct with a descriptive name. For
   example: <em>/Utest/test_case1/</em></li>
<li>Put in that directory an ini-file (referred to as &ldquo;master-inifile&rdquo;)
   and all the relevant files for a simulation, e.g. geometry file, etc. In the master-inifile you can use python syntax</li>
</ul>
<p>Example:</p>
<pre><code class="xml">   &lt;max_sim_time&gt;[3,4]&lt;/max_sim_time&gt; 
   &lt;seed&gt;range(1, 10)&lt;/seed&gt;
</code></pre>

<ul>
<li>run the script <code>makeini.py</code> with the obligatory option <code>-f</code>: Using the
    aforementioned example the call is:</li>
</ul>
<pre><code class="bash">   python makeini.py -f test_case1/inifile.xml
</code></pre>

<p>The Script is going to create two directories:
- test_case/trajectories: Here live the simulation trajectories.
- test_case/inifiles: and here the inifiles, that will be produced  based on the master inifile (in this case test_case1/inifile.xml).
    Note, that the geometry file and the trajectory files are all relative to the project files in the directory <em>inifiles</em>.</p>
<ul>
<li>Write a runtest-script. Here you have to define the logic of your test. What should be tested? When does the file succeed or file? etc.</li>
</ul>
<p>Your script has to start with the following lines:</p>
<pre><code class="python">#!/usr/bin/env python
import os
import sys
from sys import *
sys.path.append(os.path.abspath(os.path.dirname(sys.path[0])))
from JPSRunTest import JPSRunTestDriver
from utils import *
</code></pre>

<p>After including these lines you can write the test you want to perform for every ini-file generated from the makeini.py script.
The method signature must contain at least two arguments to receive the inifile and the trajectory file from the simulation.</p>
<pre><code class="python">def runtest(inifile, trajfile):
</code></pre>

<p>You can also use more than these arguments like this:</p>
<pre><code class="python">def runtest(inifile, trajfile, x, y, z):
</code></pre>

<p>If you need a more complex example of how to use more arguments for further calculations please see runtest_14.py.
If a test has to fail because an error occurs or a necessary condition is not fulfilled  you can simply exit the script by using something like</p>
<pre><code class="python">if condition_fails: 
  exit(FAILURE)
</code></pre>

<p>Once you have written your test you have to make your script executable, so it has to contain a main function which calls the test:</p>
<pre><code class="python">if __name__ == &quot;__main__&quot;:
  test = JPSRunTestDriver(1, argv0=argv[0], testdir=sys.path[0])
  test.run_test(testfunction=runtest)
  logging.info(&quot;%s exits with SUCCESS&quot; % (argv[0]))
  exit(SUCCESS)
</code></pre></div>
        </div>

	<footer class="col-md-12">
		<hr>
		
		<p>Copyright &copy; 2016 <a href="http://www.fz-juelich.de">Forschungszentrum Jülich GmbH</a>. Maintenance by <a href="http://www.fz-juelich.de/SharedDocs/Personen/IAS/JSC/EN/staff/zhang_ju.html/">Jun Zhang</a>.</p>
		
		<p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
	</footer>


        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </body>
</html>